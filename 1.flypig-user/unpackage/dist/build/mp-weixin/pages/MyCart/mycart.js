(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/MyCart/mycart"],{"17d3":function(t,o,n){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=i(n("a34a"));function i(t){return t&&t.__esModule?t:{default:t}}function a(t,o,n,e,i,a,r){try{var c=t[a](r),l=c.value}catch(s){return void n(s)}c.done?o(l):Promise.resolve(l).then(e,i)}function r(t){return function(){var o=this,n=arguments;return new Promise(function(e,i){var r=t.apply(o,n);function c(t){a(r,e,i,c,l,"next",t)}function l(t){a(r,e,i,c,l,"throw",t)}c(void 0)})}}var c=wx.cloud.database(),l=c.collection("Shopping"),s=function(){return n.e("components/HM-messages/HM-messages").then(n.bind(null,"791b"))},u=function(){return n.e("element/order").then(n.bind(null,"9027"))},d={components:{HMmessages:s,order:u},data:function(){return{mycary:!1,homeload:!0,samllload:!1,alldats:"hide",labfale:!1,editdata:"编辑",shopbottom:!0,current:"",indexArray:[],shoplist:[],select:"",obtainprice:0,arrtotalPrice:[],fandsdata:{},Duplicate:[]}},methods:{finalchange:function(){var t=this;l.get().then(function(o){if(0===o.data.length){t.homeload=!1,t.mycary=!1;var n=!0,e="购物车空空如也！";t.nohint(n,e)}else{var i=o.data;t.setUp(i),console.log("不为空")}}).catch(function(t){console.log(t)})},setUp:function(){var t=r(e.default.mark(function t(o){return e.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.forchange(o);case 2:return t.sent,t.next=5,this.shopdatas();case 5:case"end":return t.stop()}},t,this)}));function o(o){return t.apply(this,arguments)}return o}(),forchange:function(t){return new Promise(function(o,n){var e=0;t.forEach(function(i){l.doc(i._id).update({data:{Selection:"hide"}}).then(function(n){console.log(n),e++,e===t.length&&(console.log("循环结束"),o("success"))}).catch(function(t){n(t)})})})},shopdatas:function(){var t=this;l.get().then(function(o){if(console.log(o),0!=o.data.length){console.log("某些执行会走我"),t.shoplist=o.data,t.mycary=!0;var n=!1,e="";return t.nohint(n,e),void(t.homeload=!1)}t.mycary=!1;var i=!0,a="购物车空空如也！";t.nohint(i,a),t.homeload=!1}).catch(function(t){console.log(t)})},eDit:function(){this.editdata="完成"==this.editdata?"编辑":"完成",console.log(this.editdata),"完成"==this.editdata?this.shopbottom=!1:"编辑"==this.editdata&&(this.shopbottom=!0)},radioLin:function(t,o,n){if(this.samllload=!0,"hide"==t){console.log("未选中图标变选中");var e="show";this.selecTion(e,o),this.indexArray.push(o),console.log(this.indexArray);var i={id:o,totalPrice:n};this.arrtotalPrice.push(i)}else{console.log("选中变未选中");var a="hide";this.selecTion(a,o);var r=this.indexArray.indexOf(o);this.indexArray.splice(r,1),console.log(this.indexArray);var c=[o],l=this.arrtotalPrice.filter(function(t){return!c.includes(t.id)});this.arrtotalPrice=l,console.log(this.arrtotalPrice)}},selecTion:function(t,o){var n=this;l.doc(o).update({data:{Selection:t}}).then(function(t){n.shopdatas(),n.samllload=!1}).catch(function(t){console.log(t)})},deleShop:function(){var t=this;this.samllload=!0,this.indexArray.forEach(function(o){l.doc(o).remove().then(function(n){console.log(n),t.indexArray=[],t.shopdatas();var e=t.arrtotalPrice.filter(function(t){return!o.includes(t.id)});t.arrtotalPrice=e,t.samllload=!1}).catch(function(t){console.log(t)})})},Allelection:function(){var t=this;if(this.samllload=!0,"hide"==this.alldats){console.log("全选");var o="show";this.publicAll(o),this.shoplist.forEach(function(o){var n={id:o._id,totalPrice:o.totalPrice};t.arrtotalPrice.push(n),console.log("全选循环结束"),t.Duplicate.push(o._id),t.indexArray=Array.from(new Set(t.Duplicate)),console.log(t.indexArray)})}else{console.log("取消全选");var n="hide";this.publicAll(n),this.obtainprice=0,this.arrtotalPrice=[],this.indexArray=[],console.log(this.indexArray)}},publicAll:function(t){var o=this,n=0;this.shoplist.forEach(function(e){l.doc(e._id).update({data:{Selection:t}}).then(function(t){n++,n===o.shoplist.length&&(o.shopdatas(),o.samllload=!1)}).catch(function(t){console.log(t)})})},pLus:function(t,o,n){this.samllload=!0,o++;var e=t*o;this.publicPrice(n,o,e)},reDuce:function(t,o,n){if(1===o){var e="购买数量最少为1",i="danger";this.tips(e,i)}else{this.samllload=!0,o--;var a=t*o;this.publicPrice(n,o,a)}},publicPrice:function(t,o,n){var e=this;l.doc(t).update({data:{many:o,totalPrice:n}}).then(function(o){l.where({_id:t}).get().then(function(o){console.log("总价是多少"),console.log(o.data[0].totalPrice);var n=o.data[0].totalPrice,i={id:t,totalPrice:n},a=e.arrtotalPrice.map(function(o){return o.id==t?i:o});console.log(a),e.arrtotalPrice=a,e.samllload=!1}).catch(function(t){console.log(t)}),e.shopdatas()}).catch(function(t){console.log(t)})},placEorder:function(){var o={obtainprice:this.obtainprice,page:"Shopping"},n=JSON.stringify(o);t.navigateTo({url:"../order/order?ids="+n})},tips:function(t,o){this.HMmessages.show(t,{icon:o,iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(102, 0, 51,.8)"})},nohint:function(t,o){var n=this;this.$nextTick(function(){n.$refs.orderlisty.init(t,o)})}},mounted:function(){this.finalchange()},computed:{deleBtn:function(){0==this.indexArray.length?(this.labfale=!1,console.log("不可以删除")):(this.labfale=!0,console.log("可以删除"))},allList:function(){var t=this.shoplist.map(function(t){return t.Selection});this.select=t},Calculation:function(){var t={},o=this.arrtotalPrice.reduce(function(o,n){return!t[n.id]&&(t[n.id]=o.push(n)),o},[]),n=0;o.forEach(function(t){n+=t.totalPrice}),this.obtainprice=parseFloat(n.toFixed(10)),console.log(o),console.log(parseFloat(n.toFixed(10)))}},watch:{select:function(t,o){var n=t.every(function(t){return"show"===t});!0===n?(console.log("全选"),this.alldats="show"):(console.log("取消全选"),this.alldats="hide")}}};o.default=d}).call(this,n("543d")["default"])},"196d":function(t,o,n){"use strict";(function(t){n("bb5b"),n("921b");e(n("66fd"));var o=e(n("5b8d"));function e(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,n("543d")["createPage"])},"49be":function(t,o,n){"use strict";n.r(o);var e=n("17d3"),i=n.n(e);for(var a in e)"default"!==a&&function(t){n.d(o,t,function(){return e[t]})}(a);o["default"]=i.a},"5b8d":function(t,o,n){"use strict";n.r(o);var e=n("fffc"),i=n("49be");for(var a in i)"default"!==a&&function(t){n.d(o,t,function(){return i[t]})}(a);n("a3e5");var r=n("2877"),c=Object(r["a"])(i["default"],e["a"],e["b"],!1,null,"7f3a967d",null);o["default"]=c.exports},8931:function(t,o,n){},a3e5:function(t,o,n){"use strict";var e=n("8931"),i=n.n(e);i.a},fffc:function(t,o,n){"use strict";var e=function(){var t=this,o=t.$createElement;t._self._c;t._isMounted||(t.e0=function(o){t.labfale&&t.placEorder()},t.e1=function(o){t.labfale&&t.deleShop()},t.e2=function(o){t.HMmessages=t.$refs.HMmessages})},i=[];n.d(o,"a",function(){return e}),n.d(o,"b",function(){return i})}},[["196d","common/runtime","common/vendor"]]]);