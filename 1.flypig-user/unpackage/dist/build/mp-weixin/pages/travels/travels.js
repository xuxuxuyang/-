(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/travels/travels"],{"1d2b":function(t,e,o){"use strict";o.r(e);var n=o("dadd"),a=o("407b");for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);o("c65e");var s=o("2877"),c=Object(s["a"])(a["default"],n["a"],n["b"],!1,null,"760f13ee",null);e["default"]=c.exports},"25c0":function(t,e,o){},"407b":function(t,e,o){"use strict";o.r(e);var n=o("66cc"),a=o.n(n);for(var i in n)"default"!==i&&function(t){o.d(e,t,function(){return n[t]})}(i);e["default"]=a.a},"66cc":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(o("a34a")),a=o("2d07"),i=o("2f62");function s(t){return t&&t.__esModule?t:{default:t}}function c(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(e){r(t,e,o[e])})}return t}function r(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function l(t,e,o,n,a,i,s){try{var c=t[i](s),r=c.value}catch(l){return void o(l)}c.done?e(r):Promise.resolve(r).then(n,a)}function u(t){return function(){var e=this,o=arguments;return new Promise(function(n,a){var i=t.apply(e,o);function s(t){l(i,n,a,s,c,"next",t)}function c(t){l(i,n,a,s,c,"throw",t)}s(void 0)})}}function d(t){return g(t)||h(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function g(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}var m=o("b244"),p=m.formatTime(new Date),v=function(){return o.e("components/HM-messages/HM-messages").then(o.bind(null,"791b"))},b=function(){return Promise.all([o.e("common/vendor"),o.e("element/modal")]).then(o.bind(null,"b4d6"))},w=wx.cloud.database(),y=w.collection("user"),M={name:"travels",components:{HMmessages:v,motal:b},data:function(){return{num:0,fication:[{name:"景点"},{name:"美食"},{name:"网红打卡"}],topimg:[],uploadvideos:!1,videos:"",address:"昆明市",classdata:"景点",titledata:"",tipsdata:"",modaishow:!1,avatarUrl:"",nickName:"",openid:"",reldata:"正在发布...请勿关闭该页面",relend:!1,watchaddress:""}},methods:{menubtn:function(t,e){this.num=t,this.classdata=e},uploadImg:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(t){var o;console.log(t.tempFilePaths[0]),(o=e.topimg).push.apply(o,d(t.tempFilePaths))},fail:function(t){console.log(t)}})},preImage:function(t){var e=this.topimg;console.log(e),console.log(t),(0,a.preview)(t,e).then(function(t){console.log(t)}).catch(function(t){console.log(t)})},deleteImg:function(t){this.topimg.splice(t,1),console.log(this.topimg)},uploadVideo:function(){var e=this;t.showLoading({title:"上传中"}),t.chooseVideo({count:1,sourceType:["camera","album"],maxDuration:20}).then(function(o){console.log(o),e.videos=o[1].tempFilePath,e.uploadvideos=!0,t.hideLoading()}).catch(function(e){console.log("上传失败"),t.hideLoading()})},deleteVideo:function(){this.videos="",this.uploadvideos=!1,console.log(this.videos)},addRess:function(){var t=this;(0,a.addressdata)().then(function(e){console.log(e);var o=e.result.ad_info.city;t.address=o}).catch(function(e){console.log("点了拒绝定位"),t.address="昆明市"})},chooseCity:function(){t.navigateTo({url:"../city/city"})},suBmitd:function(){if(console.log(this.classdata),console.log(this.titledata),console.log(this.tipsdata),console.log(this.topimg),console.log(this.videos),console.log(this.address),""==this.titledata){var t="请填写标题";this.proMpt(t)}else if(""==this.tipsdata){var e="请填写描述";this.proMpt(e)}else if(this.topimg.length<3){var o="上传的图片不少于三张";this.proMpt(o)}else console.log("可以提交"),this.userinfo()},userinfo:function(){var t=this;y.get().then(function(e){if(console.log(e),0==e.data.length)t.$nextTick(function(){t.$refs.mon.init()});else{console.log("已经登录");var o=e.data[0];t.avatarUrl=o.avatarUrl,t.nickName=o.nickName,t.openid=o._openid,t.relend=!0,t.userdata()}}).catch(function(t){console.log(t)})},userdata:function(){var t=u(n.default.mark(function t(){var e,o;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.staticImg();case 2:return e=t.sent,t.next=5,this.staticVideo();case 5:return o=t.sent,console.log(o),t.next=9,this.cloudData(e,o);case 9:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),staticImg:function(){var t=this,e=[];return new Promise(function(o,n){t.topimg.forEach(function(n){var a=n.lastIndexOf("."),i=n.slice(a),s="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(i);console.log(s),wx.cloud.uploadFile({cloudPath:"static/"+s,filePath:n}).then(function(n){console.log(n.fileID),e.push(n.fileID),console.log(e),e.length==t.topimg.length&&o(e)}).catch(function(t){console.log(t)})})})},staticVideo:function(){var t=this;return new Promise(function(e,o){if(""==t.videos)console.log("不上传"),e("");else{console.log("要上传");var n=t.videos.lastIndexOf("."),a=t.videos.slice(n),i="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(a);console.log(i),wx.cloud.uploadFile({cloudPath:"staticvideo/"+i,filePath:t.videos}).then(function(t){console.log(t),e(t.fileID)}).catch(function(t){console.log(t)})}})},cloudData:function(e,o){var n=this,a={time:p,classdata:this.classdata,titledata:this.titledata,tipsdata:this.tipsdata,address:this.address,avatarUrl:this.avatarUrl,nickName:this.nickName,openid:this.openid,staticimg:e,staticvideo:o};w.collection("userdata").add({data:{datainfo:a}}).then(function(e){console.log(e),n.reldata="发布成功，正在跳转...";var o=!0;setTimeout(function(){t.switchTab({url:"../strategy/strategy"}),n.$store.commit("roturnmuta",o)},1700)}).catch(function(t){console.log(t)})},cancel:function(){this.modaishow=!1},proMpt:function(t){this.HMmessages.show(t,{icon:"error",iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(102, 0, 51,.8)"})}},created:function(){console.log("11"),this.addRess()},computed:c({},(0,i.mapState)(["travecity"]),{count:function(){this.watchaddress=this.travecity.traveing,console.log(this.watchaddress)}}),watch:{watchaddress:function(t,e){console.log(t),this.address=t}},onShareAppMessage:function(t){return{title:"去旅游，上生如夏花旅途小程序",path:"/pages/index/index"}}};e.default=M}).call(this,o("543d")["default"])},"715c":function(t,e,o){"use strict";(function(t){o("bb5b"),o("921b");n(o("66fd"));var e=n(o("1d2b"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},c65e:function(t,e,o){"use strict";var n=o("25c0"),a=o.n(n);a.a},dadd:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.HMmessages=t.$refs.HMmessages})},a=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return a})}},[["715c","common/runtime","common/vendor"]]]);