(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/cart"],{"0021":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){return i.e("components/HM-messages/HM-messages").then(i.bind(null,"791b"))},n=wx.cloud.database(),a=n.collection("Shopping"),s={components:{HMmessages:o},data:function(){return{num:-1,datetime:"2019-10-01",departure:"",newmessage:["大理","北京","上海","昆明","上海","深圳","江苏","杭州"],commodity:{},btndata:"",unitPrice:"",totalPrice:"",many:1}},methods:{bindDateChange:function(t){this.datetime=t.target.value},menubtn:function(t,e){console.log(t),this.num=e,this.departure=t},plus:function(){this.many++;var t=this.unitPrice*this.many;this.totalPrice=parseFloat(t.toFixed(10))},reduce:function(){if(1===this.many){var t="购买数量最少为1",e="danger";this.tips(t,e)}else{this.many--;var i=this.unitPrice*this.many;this.totalPrice=parseFloat(i.toFixed(10))}},pubilcData:function(){var t={shopid:this.commodity.shopid,title:this.commodity.title,describe:this.commodity.describe,destination:this.commodity.destination,Coverimg:this.commodity.Coverimg,price:Number(this.commodity.price),enterprise:this.commodity.enterprise,logoimg:this.commodity.logoimg,datetime:this.datetime,departure:this.departure,many:this.many,totalPrice:this.totalPrice,Selection:"hide"};return t},btnShopping:function(e){if(""==this.departure){var i="请选择出发地",o="danger";this.tips(i,o)}else if("加入购物车"==e)console.log("加入购物车"),this.carTdata();else{var n={orderdata:[this.pubilcData()],page:"directorder"},a=JSON.stringify(n);console.log("直接购买"),t.navigateTo({url:"../order/order?ids="+a})}},carTdata:function(){var t=this;a.where({shopid:this.commodity.shopid}).get().then(function(e){if(console.log(e),0==e.data.length)return t.forMaldata(),void console.log("为空");0!=e.data.length&&(console.log("不为空"),a.where({shopid:t.commodity.shopid,datetime:t.datetime,departure:t.departure,many:t.many,totalPrice:t.totalPrice}).get().then(function(e){if(console.log(e),0!=e.data.length){var i="加入购物车成功",o="success";return t.tips(i,o),!1}console.log("没有相同的数据"),t.timeing()}).catch(function(t){console.log(t)}))}).catch(function(t){console.log(t)})},timeing:function(){var t=this;a.where({shopid:this.commodity.shopid,datetime:this.datetime,departure:this.departure}).get().then(function(e){console.log("出发时间和出发地一致更新该条数据的购买数量和总价即可"),console.log(e),0!=e.data.length?t.toUpdate(e.data[0]._id):(console.log("用户批量更改了数据"),t.forMaldata())}).catch(function(t){console.log(t)})},toUpdate:function(t){var e=this;a.doc(t).update({data:{many:this.many,totalPrice:this.totalPrice}}).then(function(t){console.log(t);var i="加入购物车成功",o="success";e.tips(i,o)}).catch(function(t){console.log(t)})},forMaldata:function(){var t=this;a.add({data:this.pubilcData()}).then(function(e){console.log(e);var i="加入购物车成功",o="success";t.tips(i,o)}).catch(function(t){console.log("err")})},tips:function(t,e){this.HMmessages.show(t,{icon:e,iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(102, 0, 51,.8)"})}},onLoad:function(t){console.log(JSON.parse(t.ids));var e=JSON.parse(t.ids);this.commodity=e.Shoppdata,this.unitPrice=Number(this.commodity.price),this.totalPrice=Number(this.commodity.price),"shopping"==e.listing?this.btndata="加入购物车":this.btndata="立即下单"}};e.default=s}).call(this,i("543d")["default"])},"87ca":function(t,e,i){"use strict";var o=i("e131"),n=i.n(o);n.a},"98c1":function(t,e,i){"use strict";(function(t){i("bb5b"),i("921b");o(i("66fd"));var e=o(i("bb6a"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},a263:function(t,e,i){"use strict";i.r(e);var o=i("0021"),n=i.n(o);for(var a in o)"default"!==a&&function(t){i.d(e,t,function(){return o[t]})}(a);e["default"]=n.a},af6e:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.HMmessages=t.$refs.HMmessages})},n=[];i.d(e,"a",function(){return o}),i.d(e,"b",function(){return n})},bb6a:function(t,e,i){"use strict";i.r(e);var o=i("af6e"),n=i("a263");for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);i("87ca");var s=i("2877"),c=Object(s["a"])(n["default"],o["a"],o["b"],!1,null,null,null);e["default"]=c.exports},e131:function(t,e,i){}},[["98c1","common/runtime","common/vendor"]]]);